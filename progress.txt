foundation-001-validator-entrypoints: Created standardized validator scripts (lint.sh, typecheck.sh, test.sh) with virtualenv management, requirements-dev.txt, and brownfield-safe tool configurations (ruff, mypy) in pyproject.toml. All validators pass.
quality-001-formatting: Added ruff format configuration to pyproject.toml, integrated format check into lint.sh, created format.sh for developer auto-fix, and formatted 15 files. All validators pass.
quality-002-lint-static-analysis: Verified ruff linting configuration with E (pycodestyle) and F (pyflakes) rules, scoped to lintScope with targeted per-file ignores. Integrated into lint.sh. All validators pass.
quality-003-typecheck: Verified mypy type checking with brownfield-safe configuration in pyproject.toml, scoped to server/, harness/, tests/, and conftest.py. Fast and deterministic execution integrated into typecheck.sh. All validators pass.
tests-001-unit-test-harness: Added characterization tests for /health endpoint, root redirect, UI mount, and CORS middleware in test_api_endpoints.py. Verified existing tests for config parsing, validators, and progress managers. All tests hermetic and integrated into test.sh. 31 tests pass.
tests-002-critical-path-regression-suite: Created test_critical_paths.py with black-box smoke tests for server health, runs listing, leaderboard, task discovery, models capabilities, and OpenAPI schema. Suite runs in <2 seconds. 43 tests pass.
tests-003-integration-tests: Created test_integration.py with integration tests for database init/queries, filesystem persistence, and WebSocket streams via ProgressManager. Tests use real SQLite DB, tempdir for filesystem isolation, and asyncio for stream validation. All hermetic and fast. 48 tests pass.
tests-004-e2e-smoke: E2E smoke tests already implemented in test_api_endpoints.py. Tests exercise create_app(), verify /ui mount, /health endpoint, root redirect, and CORS middleware. Happy path focused, hermetic, and reproducible. All validators pass.
quality-004-coverage-reporting: Enabled pytest-cov with coverage tracking for server/ and harness/. Set baseline threshold to 24% (current coverage 24.35%). Added term-missing and HTML reports (htmlcov/). Coverage prevents regression and will be published in CI. All validators pass.
ci-001-quality-gates: Created GitHub Actions workflow (.github/workflows/quality-gates.yml) that runs lint, typecheck, and test validators on push and PR. Uses Python 3.11, caches pip and virtualenv for speed, fails on validator failures, uploads coverage to Codecov and artifacts. All validators pass.
security-001-dependency-vulnerability-scan: Added pip-audit scanning via scripts/security-scan.sh for all requirements files. Created .pip-audit-suppressions.txt with documented justifications for 3 transitive dependency CVEs. Added docs/SECURITY.md with remediation workflow. Integrated into CI workflow. All validators pass.
security-002-secret-scanning: Integrated Gitleaks for secret scanning via GitHub Actions workflow (.github/workflows/secret-scanning.yml). Created .gitleaks.toml with allowlist configuration. Updated docs/SECURITY.md with secret rotation process and best practices. Scans run on push and PR. Gitleaks does not log sensitive values. All validators pass.
quality-005-precommit-hooks: Added pre-commit framework configuration (.pre-commit-config.yaml) with ruff format/check, file validators, and gitleaks. Runs on staged files only for speed. Added pre-commit to requirements-dev.txt. Created docs/DEVELOPMENT.md with setup instructions. Hooks optional but consistent with CI. Cross-platform compatible. All validators pass.
foundation-002-dependency-lockfiles: Introduced pip-tools for deterministic dependency locking. Created .in source files (server/requirements.in, harness/requirements.in, requirements-dev.in) and generated .txt lock files with pinned transitive dependencies using pip-compile. Created scripts/compile-deps.sh to regenerate locks and scripts/check-deps.sh to verify locks are current. Updated .github/workflows/quality-gates.yml to check lock files in CI. All validators (lint, typecheck, test, check-deps) pass.
foundation-003-python-version-policy: Added Python 3.11+ requirement to pyproject.toml. Created scripts/check-python-version.sh with version validation and integrated preflight checks into all validator scripts (lint.sh, typecheck.sh, test.sh, format.sh, check-deps.sh, compile-deps.sh, security-scan.sh). Updated CI to test on Python 3.11 and 3.12 (cache keys already include python version). All validators pass.
quality-006-no-debug-output: Enabled ruff T201 rule to detect print() statements in Python code. Created scripts/check-console-log.sh to detect ungated console.log in GUI files (allows only DEBUG-gated usage). Integrated console.log check into lint.sh. No print() statements found in codebase; all console.log usage already properly gated behind DEBUG flag. CI will fail on any new ungated debug output. All validators pass.
quality-007-dead-code-and-import-hygiene: Added vulture (2.14) for dead-code detection with 80% confidence threshold. Created .vulture-allowlist.py with documented false positives (Pydantic cls parameters, SQLAlchemy Column imports, type hint imports, and one brownfield defaultdict import). Integrated vulture into lint.sh. All validators pass with high signal-to-noise ratio.
quality-008-frontend-quality-gates: Created scripts/check-frontend.sh with minimal lightweight checks for gui/ (balanced braces, debugger statements, var usage warnings, trailing whitespace warnings). Brownfield-safe with warnings instead of hard failures for formatting issues. Integrated into lint.sh. Fast execution without Node.js/npm dependencies. All validators pass.
tests-005-websocket-stream-contract: Created test_websocket_streams.py with 10 tests covering WebSocket stream contracts for /runs/{run_id}/stream and /qa/runs/{run_id}/stream endpoints. Tests verify event ordering (init -> attempt(s) -> complete/error), event shape, missing run_id handling (4404 close code), and cleanup via unsubscribe. Tests use fresh ProgressManager instances per test to ensure hermetic execution. All validators pass. 58 tests pass with 24.71% coverage.
tests-006-harness-retry-resume-tests: Created test_harness_retry_resume.py with 35 comprehensive unit tests for load_api_error_attempts, load_failed_attempts, and load_incomplete_attempts. Tests validate directory name parsing (task_id/model/sample/thinking_level), API error pattern detection (RateLimitError/EmptyResponseError/ProviderError/429), transient API error classification excluding user-code failures, JSON parsing from attempts.json/summary.json, and edge cases (invalid sample numbers, empty directories, multi-underscore models). All tests use tmp_path fixtures for hermetic execution. Suite is fast and does not run tasks/* tests. All validators pass. 93 tests pass with 26.87% coverage.
tests-007-database-utils-and-session-tests: Created test_database_utils.py with 32 unit tests for database utilities (parse_timestamp, extract_usage_tokens, count_errors_from_summary) and 3 integration tests for get_session transactional behavior. Unit tests validate timezone normalization (UTC conversion to naive datetime), fallback to current time on invalid input, OpenAI/Anthropic token extraction with precedence, malformed JSON handling (added AttributeError to except clause), and case-insensitive status matching. Integration tests validate get_session context manager, auto-commit on success, and rollback on exception. All tests use the actual database with unique IDs and cleanup. All validators pass. 125 tests pass with 27.27% coverage.
security-003-sast-bandit: Added Bandit 1.8.0 SAST scanning via scripts/bandit.sh. Created .bandit.yml config scoped to server/ and harness/ (excludes tests). Skipped low-value checks (B101 assert_used, B404 import subprocess, B603 subprocess shell=False). Found 2 medium-severity issues (B113 requests timeout false positive, B310 urlopen localhost-only). Added inline # nosec suppressions with justifications in server/routes/router.py:325 and harness/expert_questions/run_benchmark.py:354. Integrated into CI (.github/workflows/quality-gates.yml). Created docs/BANDIT.md with suppression policy and guidelines. Enforcement: fail on medium+ severity. All validators pass.
security-004-semgrep-lightweight: Added Semgrep 1.102.0 lightweight security scanning via scripts/semgrep.sh. Created .semgrep.yml with minimal ruleset (12 rules) covering Python (SQL injection, hardcoded secrets, eval/exec, pickle, shell injection, weak hashes) and JavaScript (eval, innerHTML XSS, document.write XSS, open redirect). Scoped to server/, harness/, and gui/ with exclusions for tasks/, runs/, .venv/. Found 13 WARNING-level findings in GUI (innerHTML usage, local redirect), all documented in .semgrep-suppressions.txt with justifications. Created docs/SEMGREP.md with configuration, suppression policy, and remediation workflow. Integrated into CI (.github/workflows/quality-gates.yml). Enforcement: fail on ERROR severity, report WARNING. Fast execution (<10s). All validators pass. 125 tests pass with 27.27% coverage.
ci-002-python-version-matrix: Verified CI already runs validators (lint, typecheck, test, security scans) across Python 3.11 and 3.12 matrix. Cache keys include both Python version and dependency lock hashes. Tasks/* suites excluded from default CI job via pytest.ini configuration. Added fail-fast: true to strategy to stop all jobs on first failure. CI provides clear failure reporting per Python version. All validators pass.
ci-003-ci-artifacts-and-junit: Configured pytest to emit JUnit XML (junit.xml) and coverage XML (coverage.xml) reports via pytest.ini addopts. Updated CI workflow to upload JUnit results, coverage XML, and coverage HTML as artifacts on all runs (if: always()) with 7-day retention. Artifacts are scoped per Python version (py3.11/py3.12). Added EnricoMi/publish-unit-test-result-action for PR annotations on test failures. Updated .gitignore to exclude junit.xml and coverage.xml from version control. All validators pass. 125 tests pass with 27.27% coverage.
quality-009-pytest-warnings-policy: Configured CI to run tests with strict warning filters (-W error::DeprecationWarning -W error::PendingDeprecationWarning). Fixed pytest-asyncio warning by setting asyncio_default_fixture_loop_scope=function in pytest.ini. Added filterwarnings section to pytest.ini for whitelisting unavoidable third-party warnings. Local development remains permissive while CI enforces strict warnings. Policy does not apply to tasks/* suites (excluded via testpaths). All validators pass. 125 tests pass with 27.27% coverage.
quality-010-shellcheck-scripts: Added ShellCheck via scripts/shellcheck.sh to scan scripts/*.sh for portability bugs. Fixed SC2064 warnings in check-console-log.sh, check-deps.sh, security-scan.sh (trap with single quotes for proper variable expansion). Fixed SC2086 in security-scan.sh (using array instead of string for IGNORE_ARGS). Suppressed SC1091 (dynamically sourced files). All scripts use bash explicitly (#!/usr/bin/env bash). Integrated into CI (.github/workflows/quality-gates.yml). Fast execution (<1s). All validators pass. 125 tests pass with 27.27% coverage.
quality-011-openapi-schema-validation: Created scripts/openapi-validate.sh to generate and validate the FastAPI OpenAPI schema using openapi-spec-validator (0.7.1). Added docs/openapi-snapshot.json as stable schema snapshot for detecting accidental breaking changes (warn-only initially). Schema generation uses create_app() directly without network calls or task execution. Integrated into CI (.github/workflows/quality-gates.yml). All validators pass. 125 tests pass with 27.27% coverage.
tests-008-api-contract-tests: Created test_api_contracts.py with 54 API contract tests covering HTTP boundary validation for FastAPI endpoints. Tests verify response status codes and JSON schema shapes for key endpoints (list runs, get run, leaderboard, model capabilities). Coverage includes both code and QA routers with 17 test classes. Added comprehensive negative tests for invalid input (missing required fields, empty models, invalid format patterns, out-of-range values) ensuring consistent 400/404/422 error responses. Tests are fully hermetic with no external network calls, no task execution, and no temp dirs/DB needed. All validators pass. 179 tests pass with 29.91% coverage.
tests-009-auth-permission-matrix: Created test_auth_permission_matrix.py with 62 comprehensive auth tests covering BENCHMARK_API_TOKEN across all mutating endpoints. Tests enumerate all 9 mutating endpoints (POST /runs, DELETE /leaderboard, POST /runs/*/retry-*, POST /runs/*/resume, and QA equivalents) and verify: missing token returns 401, invalid token returns 401, correct token allows access (non-401), and endpoints work without token when BENCHMARK_API_TOKEN is unset. Read-only GET endpoints verified accessible without auth. Added edge case tests for auth header format (case sensitivity, whitespace, Basic auth rejection). All validators pass. 241 tests pass with 46.59% coverage.
tests-010-harness-patch-parser-fuzz: Created test_harness_patch_parser_fuzz.py with Hypothesis-based fuzz tests for _is_probably_valid_patch and _normalize_patch_format. Added 6 fuzz test methods using strategies for patch-like text, arbitrary text, binary-like input, and hunk headers. Added 25 regression tests for edge formats: empty strings, missing headers, malformed hunks, mixed whitespace, partial diffs, unicode content, CRLF line endings, zero-length hunks, leading spaces, multiple files, rename/binary markers. Runtime bounded with max_examples=200 and suppress_health_check for CI-friendliness. Tests are deterministic and do not touch filesystem. All validators pass. 275 tests pass with 49.51% coverage.
tests-011-progress-backpressure-and-cleanup: Created test_progress_stress.py with 21 stress tests for progress managers. Tests cover many subscribers (50+) receiving all events in order, subscriber churn during publishing, strict event ordering under load (500 events), late subscriber history replay, memory cleanup verification (complete+unsubscribe removes run state), queue garbage collection after unsubscribe, many runs without memory growth, concurrent thread publishing (10 threads x 20 events), thread pool stress (8 workers x 50 events), edge cases (nonexistent runs, wrong queues, double unsubscribe, racing complete/fail). Both CodeProgressManager and QAProgressManager tested. All stress tests bounded and fast (<8s). All validators pass. 296 tests pass with 49.56% coverage.
security-005-license-compliance-scan: Added pip-licenses 5.0.0 for Python license compliance scanning via scripts/license-scan.sh. Defined allowlist (MIT/BSD/Apache-2.0/ISC/PSF/LGPL/MPL-2.0/etc.) and denylist (GPL/AGPL) policy. Created .license-policy.txt for package-specific exceptions. Generates license inventory at docs/license-inventory.txt in markdown format. Created docs/LICENSE-POLICY.md with policy documentation and remediation workflow. Integrated into CI (.github/workflows/quality-gates.yml). Fail on denied licenses, warn-only on unknown for brownfield adoption. Scanning is offline and does not leak dependency metadata. All validators pass. 296 tests pass with 49.56% coverage.
security-006-sbom-generation: Added cyclonedx-bom 4.6.1 for SBOM generation via scripts/sbom.sh. Generates CycloneDX 1.5 format SBOMs (JSON and XML) from locked dependencies in virtualenv. SBOM includes all packages with versions, licenses, and hashes. Secrets excluded by design (only package metadata from pip). Added docs/sbom/ to .gitignore. Created docs/SBOM.md with documentation and usage examples. Integrated into CI (.github/workflows/quality-gates.yml) with 30-day artifact retention. All validators pass. 296 tests pass with 49.56% coverage.
ci-004-nightly-deep-scans: Created .github/workflows/nightly-deep-scans.yml with scheduled workflow running nightly at 2AM UTC. Runs full extended scans: Semgrep with p/python, p/javascript, p/security-audit, p/secrets rulesets; full pip-audit vulnerability scan; Bandit SAST; license compliance scan; SBOM generation. Includes baseline comparison to track new findings, automatic issue creation for critical findings, 30-day artifact retention. Weekly extended analysis job (Sundays only) runs additional tools (safety, pipdeptree). Uses same Python 3.11 and locked dependencies as PR workflows. Tasks/* suites excluded via exclusion patterns. Manual workflow_dispatch trigger supported. All validators pass. 296 tests pass with 49.56% coverage.
ci-005-diff-coverage-and-pr-comment: Added diff-cover 9.2.0 for diff coverage enforcement via scripts/diff-cover.sh. Script compares coverage of changed files against origin/main, excludes tasks/*, runs/*, .venv/*, __pycache__/*. Updated CI workflow with fetch-depth: 0 for full git history, permissions for PR comments. CI runs diff-cover on PRs with HTML report generation. Posts concise coverage summary as PR comment using github-script (updates existing comment to avoid spam). Added diff-cover report artifacts. Brownfield-friendly: warn-only mode initially (DIFF_COVER_WARN_ONLY=true), configurable DIFF_COVER_FAIL_UNDER threshold for future enforcement. All validators pass. 296 tests pass with 49.56% coverage.
foundation-004-bootstrap-script: Created scripts/bootstrap.sh for deterministic local development setup. Script creates .venv if missing (idempotent), installs locked dependencies from server/requirements.txt, harness/requirements.txt, and requirements-dev.txt (same as CI validators). Sets up pre-commit hooks automatically. Verifies installation by checking key tools (pytest, ruff, mypy, vulture, bandit). Prints next-step commands for activation, validators, devserver, and .env setup. No secrets read (only .env.example mentioned in instructions). Works on macOS/Linux with bash. All validators pass. 296 tests pass with 49.56% coverage.
security-007-codeql: Added GitHub CodeQL analysis workflow (.github/workflows/codeql.yml) for Python and JavaScript scanning. Runs on push/PR to main branches and weekly schedule (Sundays 3AM UTC). Scans server/, harness/, gui/, conftest.py with exclusions for tasks/*, runs/, .venv/, __pycache__/, node_modules/. Uses security-and-quality query suite for comprehensive analysis. SARIF results uploaded to GitHub Security tab. Brownfield-safe: warn-only initially (no fail-on setting). Concurrency control prevents duplicate runs. All validators pass. 296 tests pass with 49.56% coverage.
security-008-dependency-review: Added GitHub Dependency Review action to PR workflows (.github/workflows/quality-gates.yml). Configured to fail on high/critical severity vulnerabilities. Scoped to core repository requirements files (server/, harness/, requirements-dev.txt) via allow-paths, excluding tasks/* workspace deps. Supports pip-tools lockfile strategy (both .in and .txt files). Added license blocking for GPL-3.0 and AGPL-3.0 with brownfield-safe allow-unknown-licenses setting. Posts comment summary on failure. Updated docs/SECURITY.md with comprehensive emergency override documentation including admin bypass, label-based skip, and mandatory follow-up requirements. All validators pass. 296 tests pass with 49.56% coverage.
quality-012-openapi-diff: Created scripts/openapi-diff.sh for detecting breaking API changes via OpenAPI schema diff against snapshot. Classifies changes as breaking (removed endpoints/fields, tightened validation, added required fields) or additive (new endpoints/fields, loosened validation). Fails CI on breaking changes, warns on additive changes initially. Provides --update flag for deliberate snapshot updates and --strict flag to fail on any change. Created docs/OPENAPI-DIFF.md with documentation. Integrated into CI (.github/workflows/quality-gates.yml). Process is hermetic (no network calls, no task execution) and fast. All validators pass. 296 tests pass with 49.56% coverage.
