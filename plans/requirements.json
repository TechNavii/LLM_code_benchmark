{
  "meta": {
    "name": "Benchmark Harness: Quality Checks & Tests",
    "description": "Incrementally harden the benchmark harness (FastAPI server + Python harness + GUI) with reproducible validators, lint/format/type checks, test coverage, CI gates, and basic security scans.",
    "projectDir": "/Users/tooru/Desktop/coding_test/benchmark",
    "structure": {
      "src": "server/",
      "tests": "tests/",
      "public": "gui/",
      "harness": "harness/",
      "tasks": "tasks/",
      "runs": "runs/",
      "scripts": "scripts/",
      "docs": "docs/",
      "venv": ".venv/"
    },
    "lintScope": [
      "server/",
      "harness/",
      "tests/",
      "conftest.py"
    ],
    "excludePatterns": [
      "runs/",
      ".venv/",
      ".pytest_cache/",
      "__pycache__/",
      "tasks/**/workspace/"
    ],
    "validators": {
      "lint": "cd /Users/tooru/Desktop/coding_test/benchmark && ./scripts/lint.sh",
      "typecheck": "cd /Users/tooru/Desktop/coding_test/benchmark && ./scripts/typecheck.sh",
      "test": "cd /Users/tooru/Desktop/coding_test/benchmark && ./scripts/test.sh"
    },
    "notes": [
      "This is a brownfield plan: prefer incremental, non-breaking changes and characterization tests around existing behavior.",
      "The default pytest suite is under tests/ and harness/tests (see pytest.ini). Do NOT add tasks/* test suites to the default validators: many tasks are intentionally incomplete and should not gate repo health.",
      "Prefer running tools from the local virtualenv at .venv (create it if missing). Keep validators deterministic and fast.",
      "When configuring tools (formatter/linter/type checker), scope to meta.lintScope and exclude meta.excludePatterns.",
      "Avoid touching generated artifacts and caches listed in meta.excludePatterns.",
      "Never commit secrets: .env is local-only; keep .env.example updated when adding required variables."
    ]
  },
  "features": [
    {
      "id": "foundation-001-validator-entrypoints",
      "priority": 1,
      "category": "foundation",
      "description": "Create standardized validator entrypoints (lint/typecheck/test) for the benchmark repo",
      "steps": [
        "Create executable scripts in scripts/: lint.sh, typecheck.sh, test.sh (alongside devserver.sh)",
        "Each script should ensure a local virtualenv exists at .venv and runs tools from it (prefer invoking .venv/bin/python -m ... / .venv/bin/ruff)",
        "Install runtime deps (server/requirements.txt + harness/requirements.txt) and a dev requirements file (e.g., requirements-dev.txt) as needed",
        "Ensure scripts are idempotent and fail fast (non-zero exit) when checks fail",
        "Verify all scripts run locally and deterministically from a clean checkout",
        "Test script should run only repository tests (pytest.ini testpaths) and must not run tasks/* suites by default"
      ],
      "passes": true
    },
    {
      "id": "quality-001-formatting",
      "priority": 2,
      "category": "quality",
      "description": "Introduce consistent formatting checks for Python code without large-scale churn",
      "steps": [
        "Adopt a Python formatter (prefer ruff format; black acceptable) and configure it (pyproject.toml or ruff.toml)",
        "Scope formatting to meta.lintScope and exclude meta.excludePatterns",
        "Add a check mode and integrate it into ./scripts/lint.sh",
        "Provide a developer fix command (non-CI), but keep CI on check-only"
      ],
      "passes": true
    },
    {
      "id": "quality-002-lint-static-analysis",
      "priority": 3,
      "category": "quality",
      "description": "Add Python linting/static analysis tuned for an existing codebase",
      "steps": [
        "Use ruff for linting (start with a small, high-signal ruleset to avoid refactor churn)",
        "Configure scope to meta.lintScope and excludes to meta.excludePatterns",
        "Add targeted ignores only where needed and keep rationale minimal",
        "Integrate into ./scripts/lint.sh and ensure it runs on CI"
      ],
      "passes": true
    },
    {
      "id": "quality-003-typecheck",
      "priority": 4,
      "category": "quality",
      "description": "Establish type checking (or equivalent static checks) with incremental strictness",
      "steps": [
        "Add Python type checking (mypy or pyright) with brownfield-safe settings",
        "Limit scope initially to server/ and harness/ if full strictness is not immediately feasible",
        "Ensure the typecheck command is fast and deterministic",
        "Integrate into ./scripts/typecheck.sh (invoked via meta.validators)"
      ],
      "passes": true
    },
    {
      "id": "tests-001-unit-test-harness",
      "priority": 5,
      "category": "tests",
      "description": "Standardize pytest execution and expand characterization/unit tests for server + harness",
      "steps": [
        "Use pytest (already configured via pytest.ini) as the default test runner",
        "Ensure pytest and test-only deps are installed via a dedicated dev requirements file",
        "Add characterization tests around stable behavior (e.g., /health, config parsing, validators, progress managers)",
        "Ensure tests are hermetic where possible and avoid reliance on developer machine state",
        "Integrate into ./scripts/test.sh (invoked via meta.validators)"
      ],
      "passes": true
    },
    {
      "id": "tests-002-critical-path-regression-suite",
      "priority": 6,
      "category": "tests",
      "description": "Create a fast regression/smoke suite for key server and harness flows",
      "steps": [
        "Codify key flows as tests: server health, runs listing, leaderboard query, task discovery, and dry-run harness execution",
        "Prefer black-box tests at public boundaries to reduce coupling to internals",
        "Make the suite fast (target < 1–2 minutes) so it can run on every change",
        "Run this suite in CI as part of the default test job"
      ],
      "passes": true
    },
    {
      "id": "tests-003-integration-tests",
      "priority": 7,
      "category": "tests",
      "description": "Add integration tests for key integrations (SQLite DB, filesystem artifacts, WebSocket stream)",
      "steps": [
        "Add integration tests that exercise real boundaries (database init/queries, run history persistence)",
        "Use lightweight, reproducible dependencies (prefer in-memory/tempdir substitutes; keep Docker optional where appropriate)",
        "Ensure tests can run locally and on CI with minimal setup",
        "Keep integration tests selectable via marker/flag or file pattern, and keep them isolated from tasks/* suites"
      ],
      "passes": true
    },
    {
      "id": "tests-004-e2e-smoke",
      "priority": 8,
      "category": "tests",
      "description": "Add an end-to-end smoke test for the FastAPI app + UI mounts",
      "steps": [
        "Add a smoke test that exercises create_app() and verifies /ui is mounted and /health returns ok",
        "Target the happy path only at first to keep the suite stable",
        "Run e2e smoke in CI (can be separate job) and collect artifacts on failure",
        "Ensure the environment setup (ports, env vars, test data) is scripted and reproducible"
      ],
      "passes": true
    },
    {
      "id": "quality-004-coverage-reporting",
      "priority": 9,
      "category": "quality",
      "description": "Add coverage collection and enforce a brownfield-friendly baseline",
      "steps": [
        "Enable code coverage reporting in pytest (unit + integration where sensible)",
        "Record the current baseline coverage and set an initial threshold that matches it",
        "Require that new/changed code does not reduce coverage (e.g., diff coverage or incremental thresholds)",
        "Publish coverage in CI (summary + optional upload to a coverage service)"
      ],
      "passes": true
    },
    {
      "id": "ci-001-quality-gates",
      "priority": 10,
      "category": "ci",
      "description": "Add CI quality gates to run lint/typecheck/tests on every PR",
      "steps": [
        "Add a CI workflow (e.g., GitHub Actions) that runs ./scripts/lint.sh, ./scripts/typecheck.sh, and ./scripts/test.sh",
        "Cache dependencies to keep CI fast",
        "Fail the build on any validator failure",
        "Ensure CI uses a pinned Python version compatible with the project (Python 3.11+) and does not gate on intentionally-incomplete tasks/* suites"
      ],
      "passes": true
    },
    {
      "id": "security-001-dependency-vulnerability-scan",
      "priority": 11,
      "category": "security",
      "description": "Add automated dependency vulnerability scanning",
      "steps": [
        "Use a Python dependency scanner (pip-audit or osv-scanner) for server/requirements.txt, harness/requirements.txt, and dev requirements",
        "Run it in CI and fail on high/critical issues where practical (start warn-only if needed)",
        "Add an allowlist/suppressions mechanism with justification for unavoidable findings",
        "Document a basic remediation workflow (update dependencies, regenerate lockfiles)"
      ],
      "passes": true
    },
    {
      "id": "security-002-secret-scanning",
      "priority": 12,
      "category": "security",
      "description": "Add secret scanning to prevent accidental credential commits",
      "steps": [
        "Integrate secret scanning (e.g., gitleaks/trufflehog) into CI",
        "Optionally add a pre-commit hook for local protection",
        "Ensure scanning does not log sensitive values",
        "Add a documented process for rotating/removing exposed secrets"
      ],
      "passes": true
    },
    {
      "id": "quality-005-precommit-hooks",
      "priority": 13,
      "category": "quality",
      "description": "Add developer-friendly pre-commit checks to reduce CI churn",
      "steps": [
        "Add pre-commit hooks (prefer the Python pre-commit framework) to run ruff/formatting on staged files",
        "Keep hooks fast (staged-files only) and consistent with CI",
        "Keep hooks optional to install, but ensure CI remains the source of truth",
        "Ensure hooks behave consistently across platforms (macOS/Linux/Windows)"
      ],
      "passes": true
    },
    {
      "id": "foundation-002-dependency-lockfiles",
      "priority": 14,
      "category": "foundation",
      "description": "Add deterministic dependency locking for server/harness/dev tooling",
      "steps": [
        "Introduce a dependency locking mechanism (pip-tools or uv) to pin transitive versions for server/, harness/, and dev/test tooling",
        "Ensure ./scripts/lint.sh, ./scripts/typecheck.sh, and ./scripts/test.sh install from the locked sets (not floating requirements)",
        "Add a CI check that fails when lock files are out of date",
        "Keep lock generation reproducible and scoped to meta.lintScope (do not include tasks/* workspace deps)"
      ],
      "passes": true
    },
    {
      "id": "foundation-003-python-version-policy",
      "priority": 15,
      "category": "foundation",
      "description": "Pin and validate supported Python versions across local scripts and CI",
      "steps": [
        "Define an explicit supported Python version range (e.g., 3.11+) and enforce it in CI",
        "Add a lightweight preflight check in validator scripts that fails fast if the interpreter is unsupported",
        "Ensure dependencies are installed per-Python-version (cache keys include python version)",
        "Avoid relying on developer machine global site-packages"
      ],
      "passes": true
    },
    {
      "id": "quality-006-no-debug-output",
      "priority": 16,
      "category": "quality",
      "description": "Enforce no accidental debug output (print/console.log) in production paths",
      "steps": [
        "Enable a lint rule to detect print() usage in non-CLI code paths (e.g., ruff T201) and gate it in ./scripts/lint.sh",
        "Add an allowlist pattern for intentional CLI output wrappers (e.g., a dedicated _cli_echo helper)",
        "Add a check that flags un-gated console.log in gui/ (allow only when gated behind an explicit debug flag)",
        "Ensure CI fails when debug output is reintroduced"
      ],
      "passes": true
    },
    {
      "id": "quality-007-dead-code-and-import-hygiene",
      "priority": 17,
      "category": "quality",
      "description": "Add dead-code detection and import hygiene checks (brownfield safe)",
      "steps": [
        "Add a dead-code signal check (vulture or equivalent) scoped to meta.lintScope",
        "Maintain a small allowlist for known false positives and keep it under version control",
        "Keep the signal-to-noise ratio high: start warn-only, then incrementally enforce",
        "Integrate into ./scripts/lint.sh and ensure it respects meta.excludePatterns"
      ],
      "passes": true
    },
    {
      "id": "quality-008-frontend-quality-gates",
      "priority": 18,
      "category": "quality",
      "description": "Add minimal frontend quality gates for gui/ (JS/CSS) to prevent regressions",
      "steps": [
        "Add a lightweight JS/CSS lint check (eslint/stylelint or a minimal scripted check) scoped to gui/",
        "Keep configuration small to avoid large formatting churn",
        "Integrate frontend checks into ./scripts/lint.sh (or a dedicated ./scripts/frontend_lint.sh invoked by lint.sh)",
        "Exclude vendor/generated assets and keep execution fast"
      ],
      "passes": true
    },
    {
      "id": "tests-005-websocket-stream-contract",
      "priority": 19,
      "category": "tests",
      "description": "Add automated WebSocket stream contract tests for run and QA progress endpoints",
      "steps": [
        "Add FastAPI TestClient WebSocket tests for /runs/{run_id}/stream and /qa/runs/{run_id}/stream",
        "Verify event ordering and shape (init -> attempt(s) -> complete/error)",
        "Add negative tests for missing run_id (expected close code) and verify cleanup via unsubscribe",
        "Keep tests hermetic (no network calls; no task execution)"
      ],
      "passes": true
    },
    {
      "id": "tests-006-harness-retry-resume-tests",
      "priority": 20,
      "category": "tests",
      "description": "Add unit tests for harness retry/resume helpers (api_error retry + incomplete resume)",
      "steps": [
        "Add tempdir-based tests for load_api_error_attempts/load_failed_attempts/load_incomplete_attempts parsing",
        "Add tests that validate attempt directory name parsing (task/model/sample/thinking level) and edge cases",
        "Add tests that validate transient API error classification does not mark user-code failures as api_error",
        "Ensure the suite is fast and does not run tasks/* tests"
      ],
      "passes": true
    },
    {
      "id": "tests-007-database-utils-and-session-tests",
      "priority": 21,
      "category": "tests",
      "description": "Add focused unit/integration tests for database utilities and transactional session behavior",
      "steps": [
        "Unit test parse_timestamp() timezone normalization and invalid input fallback",
        "Unit test extract_usage_tokens() for OpenAI/Anthropic usage schemas",
        "Unit test count_errors_from_summary() for malformed JSON and status normalization",
        "Add a lightweight integration test confirming get_session() commits/rolls back as expected"
      ],
      "passes": true
    },
    {
      "id": "security-003-sast-bandit",
      "priority": 22,
      "category": "security",
      "description": "Add Python SAST scanning (Bandit) scoped to server/ and harness/",
      "steps": [
        "Add Bandit (or equivalent) with a small, high-signal ruleset",
        "Scope scanning to meta.lintScope and exclude meta.excludePatterns",
        "Run in CI and decide an initial enforcement policy (warn-only -> fail on high/critical)",
        "Ensure findings can be suppressed only with explicit justification"
      ],
      "passes": true
    },
    {
      "id": "security-004-semgrep-lightweight",
      "priority": 23,
      "category": "security",
      "description": "Add lightweight Semgrep rules for common Python/JS security footguns",
      "steps": [
        "Run Semgrep with a minimal ruleset scoped to server/, harness/, and gui/",
        "Exclude tasks/* workspaces and generated artifacts",
        "Run in CI and allow suppressions only when justified",
        "Keep performance fast enough to run on every PR"
      ],
      "passes": true
    },
    {
      "id": "ci-002-python-version-matrix",
      "priority": 24,
      "category": "ci",
      "description": "Run CI validators across a Python version matrix",
      "steps": [
        "Run lint/typecheck/tests on at least Python 3.11 and 3.12",
        "Ensure caching keys include Python version and dependency lock hashes",
        "Keep tasks/* suites out of the default CI job",
        "Fail fast on the first failed job and report results clearly"
      ],
      "passes": true
    },
    {
      "id": "ci-003-ci-artifacts-and-junit",
      "priority": 25,
      "category": "ci",
      "description": "Publish test artifacts (JUnit/coverage/logs) on CI failures",
      "steps": [
        "Configure pytest to emit a JUnit XML report and (when coverage is enabled) coverage XML",
        "Upload artifacts on CI failures to simplify debugging",
        "Keep artifacts scoped and size-limited (exclude runs/ and task workspaces)",
        "Optionally add PR annotations for failing tests"
      ],
      "passes": true
    },
    {
      "id": "quality-009-pytest-warnings-policy",
      "priority": 26,
      "category": "quality",
      "description": "Treat key warnings as errors in CI to prevent silent regressions",
      "steps": [
        "Configure pytest invocation in CI to fail on DeprecationWarning and PendingDeprecationWarning (e.g., -W error::DeprecationWarning -W error::PendingDeprecationWarning)",
        "Keep local developer defaults permissive if needed, but CI should be strict",
        "Whitelist unavoidable third-party warnings with targeted filters and justification",
        "Ensure the policy does not apply to tasks/* suites"
      ],
      "passes": true
    },
    {
      "id": "quality-010-shellcheck-scripts",
      "priority": 27,
      "category": "quality",
      "description": "Add ShellCheck for scripts/ to catch portability bugs",
      "steps": [
        "Add ShellCheck to CI (or run via a container) and scan scripts/*.sh",
        "Fix/annotate findings (SC* codes) with minimal suppressions",
        "Ensure scripts remain POSIX-compatible where practical (or declare bash explicitly)",
        "Exclude generated scripts and keep runtime fast"
      ],
      "passes": true
    },
    {
      "id": "quality-011-openapi-schema-validation",
      "priority": 28,
      "category": "quality",
      "description": "Validate and optionally snapshot the FastAPI OpenAPI schema",
      "steps": [
        "Add a check that generates the OpenAPI schema from the app and validates it with an OpenAPI schema validator",
        "Add a stable snapshot (JSON) to detect accidental breaking changes (optional; warn-only initially)",
        "Ensure schema generation does not require network calls or task execution",
        "Run in CI as part of the default validation job"
      ],
      "passes": true
    },
    {
      "id": "tests-008-api-contract-tests",
      "priority": 29,
      "category": "tests",
      "description": "Add API contract tests at the HTTP boundary (FastAPI TestClient)",
      "steps": [
        "Add tests that call key HTTP endpoints and validate response status codes + JSON schema shape (list runs, get run, leaderboard, model capabilities)",
        "Cover both code and QA routers",
        "Add negative tests for invalid input (validation errors) to ensure consistent error responses",
        "Keep tests hermetic: no external network, no executing tasks, and use temp dirs/DB where needed"
      ],
      "passes": true
    },
    {
      "id": "tests-009-auth-permission-matrix",
      "priority": 30,
      "category": "tests",
      "description": "Expand auth coverage for BENCHMARK_API_TOKEN across all mutating endpoints",
      "steps": [
        "Enumerate all mutating endpoints (POST/PUT/PATCH/DELETE) and ensure they require auth when BENCHMARK_API_TOKEN is set",
        "Add tests for both missing token and incorrect token (401), and correct token (200/202)",
        "Ensure read-only endpoints remain accessible without a token",
        "Add coverage for QA retry/resume endpoints and any future code-execution routes"
      ],
      "passes": true
    },
    {
      "id": "tests-010-harness-patch-parser-fuzz",
      "priority": 31,
      "category": "tests",
      "description": "Fuzz/prop-test patch normalization and validation helpers",
      "steps": [
        "Use Hypothesis (or similar) to generate random patch-like strings and ensure _is_probably_valid_patch/_normalize_patch_format never crash",
        "Add regression cases for edge formats: missing headers, malformed hunks, mixed whitespace, and partial diffs",
        "Keep runtime bounded (small examples, limited max examples) to remain CI-friendly",
        "Ensure behavior is deterministic and does not touch filesystem outside temp dirs"
      ],
      "passes": true
    },
    {
      "id": "tests-011-progress-backpressure-and-cleanup",
      "priority": 32,
      "category": "tests",
      "description": "Stress test progress managers for cleanup, ordering, and memory growth",
      "steps": [
        "Add tests that create many subscribers and publish many attempt events, asserting no deadlocks and correct ordering",
        "Verify unsubscribe/complete removes run state (no memory leak)",
        "Add tests for cross-thread publishing under load (small stress loop) to ensure thread-safety holds",
        "Keep stress tests bounded and fast"
      ],
      "passes": true
    },
    {
      "id": "security-005-license-compliance-scan",
      "priority": 33,
      "category": "security",
      "description": "Add license compliance scanning for Python and any JS dependencies",
      "steps": [
        "Generate a license inventory for Python dependencies (and JS if applicable)",
        "Define an allowlist/denylist policy (e.g., allow MIT/BSD/Apache-2.0; review GPL)",
        "Run in CI and fail (or warn initially) on disallowed/unknown licenses",
        "Keep scanning offline and ensure it does not leak dependency metadata unnecessarily"
      ],
      "passes": true
    },
    {
      "id": "security-006-sbom-generation",
      "priority": 34,
      "category": "security",
      "description": "Generate and publish SBOMs for supply-chain visibility",
      "steps": [
        "Generate a CycloneDX (or SPDX) SBOM for Python dependencies (and JS if applicable)",
        "Upload SBOM as a CI artifact and optionally attach to releases",
        "Ensure SBOM generation uses locked dependencies (once lockfiles exist)",
        "Keep secrets out of SBOM outputs"
      ],
      "passes": true
    },
    {
      "id": "ci-004-nightly-deep-scans",
      "priority": 35,
      "category": "ci",
      "description": "Add scheduled CI jobs for deeper scans without slowing PR checks",
      "steps": [
        "Add a scheduled workflow (nightly/weekly) to run slower scans (full semgrep rulesets, full pip-audit, bandit, license scan, SBOM generation)",
        "Alert on new findings and track baselines",
        "Ensure scheduled jobs use the same pinned Python and locked dependencies as PR workflows",
        "Keep tasks/* suites excluded"
      ],
      "passes": true
    },
    {
      "id": "ci-005-diff-coverage-and-pr-comment",
      "priority": 36,
      "category": "ci",
      "description": "Add diff coverage and PR reporting to prevent untested changes",
      "steps": [
        "Add diff coverage (or changed-file coverage) enforcement so new code requires tests even if global baseline is low",
        "Post a concise coverage summary on PRs (or as a CI step summary)",
        "Ensure coverage measurement is stable and does not include tasks/* workspaces or runs/",
        "Keep enforcement brownfield-friendly (warn-only -> fail after adoption)"
      ],
      "passes": true
    },
    {
      "id": "foundation-004-bootstrap-script",
      "priority": 37,
      "category": "foundation",
      "description": "Add a deterministic local bootstrap script for developers and CI parity",
      "steps": [
        "Add a ./scripts/bootstrap.sh that creates .venv, installs locked deps, and prints next-step commands",
        "Ensure bootstrap is idempotent and works on macOS/Linux (and optionally Windows instructions)",
        "Keep bootstrap free of secrets (no reading .env beyond what is required)",
        "Use the same dependency sets as CI validators"
      ],
      "passes": true
    },
    {
      "id": "security-007-codeql",
      "priority": 38,
      "category": "security",
      "description": "Add GitHub CodeQL analysis for Python and JavaScript",
      "steps": [
        "Add a GitHub Actions workflow that runs CodeQL on pull requests and on a schedule",
        "Configure CodeQL to scan Python sources (server/, harness/) and JavaScript sources (gui/)",
        "Keep scanning scoped/excluded consistent with meta.excludePatterns (exclude tasks/*, runs/, .venv/)",
        "Publish SARIF results to GitHub Security tab and fail the job on new critical/high alerts (brownfield-safe warn-only initially if needed)"
      ],
      "passes": true
    },
    {
      "id": "security-008-dependency-review",
      "priority": 39,
      "category": "security",
      "description": "Add GitHub Dependency Review to block vulnerable dependency introductions",
      "steps": [
        "Add the dependency-review-action to PR workflows",
        "Configure it to evaluate changes to locked requirements files and fail on high/critical vulnerabilities",
        "Ensure it supports the repo's lockfile strategy (pip-tools / uv) and ignores tasks/* workspace deps",
        "Add a documented override path for emergency exceptions (with justification)"
      ],
      "passes": true
    },
    {
      "id": "quality-012-openapi-diff",
      "priority": 40,
      "category": "quality",
      "description": "Detect breaking API changes via OpenAPI diff (snapshot vs generated)",
      "steps": [
        "Introduce an OpenAPI diff step that compares the generated schema against the stored snapshot",
        "Fail on breaking changes (removed endpoints/fields, tightened validation) and warn on additive-only changes initially",
        "Provide a deliberate update mechanism for snapshot changes (explicit command/script)",
        "Keep the diff process hermetic and fast (no network calls, no task execution)"
      ],
      "passes": true
    },
    {
      "id": "quality-013-ruff-ruleset-expansion",
      "priority": 41,
      "category": "quality",
      "description": "Incrementally expand ruff ruleset for higher signal bug prevention",
      "steps": [
        "Enable additional high-signal ruff rule families (e.g., bugbear, pyupgrade, simplify, perflint) in warning mode first",
        "Add targeted per-file ignores only where necessary and keep rationale minimal",
        "Adopt fixes incrementally to avoid large-scale churn",
        "Gate the expanded ruleset in ./scripts/lint.sh once noise is manageable"
      ],
      "passes": true
    },
    {
      "id": "tests-012-cli-entrypoint-smoke",
      "priority": 42,
      "category": "tests",
      "description": "Add smoke tests for harness CLI entrypoints and argument parsing",
      "steps": [
        "Add subprocess-based tests that invoke the harness CLI with --help and minimal dry-run inputs",
        "Assert exit codes and ensure output is stable enough to detect regressions",
        "Ensure tests remain hermetic (no network calls, no task execution, temp dirs only)",
        "Keep runtime fast and skip on platforms where subprocess execution is restricted (if needed)"
      ],
      "passes": true
    },
    {
      "id": "tests-013-migrations-smoke",
      "priority": 43,
      "category": "tests",
      "description": "Add migration/schema consistency checks for the server database",
      "steps": [
        "If Alembic/migrations are used, add a test that runs migrations against a fresh temp SQLite DB and validates schema creation",
        "Add a check that the migrations directory matches the current ORM model state (brownfield-safe warn-only initially)",
        "Ensure migration tests are hermetic and use temp directories",
        "Keep tasks/* suites excluded and runtime fast"
      ],
      "passes": true
    },
    {
      "id": "ci-006-concurrency-and-cancel-in-progress",
      "priority": 44,
      "category": "ci",
      "description": "Add CI concurrency controls to cancel redundant runs and reduce CI load",
      "steps": [
        "Configure GitHub Actions concurrency groups per workflow+branch so new pushes cancel in-progress jobs",
        "Ensure artifact uploads still occur for the final run and failure signals remain visible",
        "Avoid canceling scheduled deep scans unless explicitly desired",
        "Keep configuration brownfield-safe and easy to reason about"
      ],
      "passes": true
    },
    {
      "id": "quality-014-warning-free-test-suite",
      "priority": 45,
      "category": "quality",
      "description": "Make the default test suite warning-free (or explicitly justified) to prevent hidden runtime bugs",
      "steps": [
        "Update CI to fail on RuntimeWarning/ResourceWarning that indicate real bugs (e.g., un-awaited coroutines, unclosed resources)",
        "Add targeted warning filters only for known third-party noise with explicit justification",
        "Ensure local test runs remain developer-friendly while CI is strict",
        "Keep the policy scoped to the repository test suite (exclude tasks/* suites)"
      ],
      "passes": true
    },
    {
      "id": "quality-015-actionlint-workflows",
      "priority": 46,
      "category": "quality",
      "description": "Add workflow linting (actionlint) to catch GitHub Actions YAML issues early",
      "steps": [
        "Add actionlint (or equivalent) to validate .github/workflows/*.yml",
        "Run it in CI on PRs and pushes (fast, no network calls beyond fetching the linter)",
        "Keep the rules brownfield-safe (warn-only initially if needed)",
        "Ensure workflow linting respects repository constraints (no tasks/* suites, no runs/ artifacts)"
      ],
      "passes": true
    },
    {
      "id": "ci-007-os-matrix",
      "priority": 47,
      "category": "ci",
      "description": "Run CI validators on an OS matrix to ensure cross-platform script compatibility",
      "steps": [
        "Run the default quality-gates workflow on ubuntu-latest and macos-latest",
        "Ensure caching remains effective and keys include OS + Python version + lock hashes",
        "Fix any POSIX/bash portability issues surfaced by macOS",
        "Keep Windows optional unless explicitly required"
      ],
      "passes": true
    },
    {
      "id": "security-009-dependabot-updates",
      "priority": 48,
      "category": "security",
      "description": "Add Dependabot for GitHub Actions and Python dependency updates",
      "steps": [
        "Configure Dependabot to update GitHub Actions workflow versions",
        "Configure Dependabot to update pip-tools lockfiles (or equivalent) on a weekly cadence",
        "Ensure updates run validators in CI and include clear changelog summaries",
        "Keep tasks/* workspace deps excluded"
      ],
      "passes": true
    },
    {
      "id": "security-010-gha-permissions-hardening",
      "priority": 49,
      "category": "security",
      "description": "Harden GitHub Actions workflows with least-privilege permissions",
      "steps": [
        "Set workflow-level and job-level permissions blocks explicitly (default read-only unless required)",
        "Restrict token permissions for commenting/reporting steps to PR-only contexts",
        "Avoid long-lived secrets in workflows; prefer OIDC where applicable",
        "Add a periodic review checklist for workflow permissions"
      ],
      "passes": true
    },
    {
      "id": "quality-016-env-example-sync",
      "priority": 50,
      "category": "quality",
      "description": "Keep .env.example synchronized with server/harness settings",
      "steps": [
        "Add a script that introspects pydantic-settings models and verifies required env vars exist in .env.example",
        "Fail CI if a required variable is missing or if .env.example contains unknown/stale keys (allowlist where needed)",
        "Ensure the check does not reveal real secrets (only key names)",
        "Keep the check fast and deterministic"
      ],
      "passes": true
    },
    {
      "id": "tests-014-test-order-determinism",
      "priority": 51,
      "category": "tests",
      "description": "Detect hidden test-order dependencies",
      "steps": [
        "Add a CI job that runs pytest with randomized test order (seeded) to catch order-dependent tests",
        "Keep runtime bounded (e.g., nightly or separate job) if it materially slows PR checks",
        "Ensure randomness is reproducible via logged seeds",
        "Exclude tasks/* suites and keep tmp/workdir isolation intact"
      ],
      "passes": true
    },
    {
      "id": "security-011-pin-github-actions-shas",
      "priority": 52,
      "category": "security",
      "description": "Pin GitHub Actions to commit SHAs to reduce CI supply-chain risk",
      "steps": [
        "Replace version tags in workflow uses: lines with immutable commit SHAs (tooling-assisted pinning recommended)",
        "Add a CI check that fails when new unpinned actions are introduced",
        "Ensure Dependabot (or an explicit workflow) keeps pinned SHAs updated",
        "Allow exceptions only with explicit justification"
      ],
      "passes": true
    },
    {
      "id": "security-012-ossf-scorecard",
      "priority": 53,
      "category": "security",
      "description": "Add OSSF Scorecard scanning for repo supply-chain best practices",
      "steps": [
        "Run OSSF Scorecard on a schedule and on default-branch changes",
        "Upload results (e.g., SARIF) and track score deltas over time",
        "Start warn-only, then enforce a baseline once noise is understood",
        "Keep the scan scoped to the repo (exclude tasks/* workspaces where applicable)"
      ],
      "passes": true
    },
    {
      "id": "security-013-python-require-hashes",
      "priority": 54,
      "category": "security",
      "description": "Enable hash-checked Python installs (pip --require-hashes) for stronger dependency integrity",
      "steps": [
        "Generate lockfiles with hashes (pip-compile --generate-hashes) for server/, harness/, and dev tooling",
        "Update validator/bootstrap scripts to install from hashed lockfiles using --require-hashes",
        "Add a CI check that fails on missing hashes or unpinned direct URL dependencies",
        "Keep tasks/* workspace deps excluded"
      ],
      "passes": false
    },
    {
      "id": "tests-015-openapi-fuzz-schemathesis",
      "priority": 55,
      "category": "tests",
      "description": "Add OpenAPI-driven API fuzz tests to catch 500s and validation edge cases",
      "steps": [
        "Use Schemathesis (or equivalent) against the generated OpenAPI schema to generate HTTP requests",
        "Run in a nightly workflow (or separate CI job) with bounded examples/timeouts",
        "Focus on 5xx/crash detection and request validation edge cases for both code and QA routers",
        "Keep tests hermetic (no external network) and exclude tasks/* suites"
      ],
      "passes": false
    },
    {
      "id": "tests-016-gui-headless-smoke",
      "priority": 56,
      "category": "tests",
      "description": "Add headless browser smoke tests for gui/ to catch routing/JS regressions",
      "steps": [
        "Use Playwright (or equivalent) to load /ui and /qa/ui against a test server instance",
        "Assert key DOM elements render and critical JS does not throw",
        "Optionally verify a WebSocket connection can be established (mocked/init-only)",
        "Keep runtime fast and collect artifacts (trace/screenshot) on failure"
      ],
      "passes": false
    },
    {
      "id": "tests-017-harness-server-e2e-dryrun",
      "priority": 57,
      "category": "tests",
      "description": "Add an end-to-end dry-run test wiring harness CLI ↔ server API without real LLM calls",
      "steps": [
        "Start the FastAPI app in a subprocess (ephemeral port, temp DB) from the test suite",
        "Run the harness in a dry-run mode (or with a fake model provider) and assert completion",
        "Verify expected DB rows/artifacts are created and progress endpoints behave",
        "Ensure the test is hermetic and does not require OPENROUTER_API_KEY"
      ],
      "passes": false
    },
    {
      "id": "quality-017-log-redaction",
      "priority": 58,
      "category": "quality",
      "description": "Prevent accidental leakage of secrets/PII in logs",
      "steps": [
        "Add centralized log redaction for common secret patterns (API keys, Bearer tokens)",
        "Add tests asserting secrets are redacted in representative logging paths",
        "Ensure GUI debug logging remains gated and does not include tokens",
        "Keep redaction deterministic and avoid false-positive over-redaction where practical"
      ],
      "passes": false
    },
    {
      "id": "quality-018-performance-regression-budgets",
      "priority": 59,
      "category": "quality",
      "description": "Add lightweight performance regression checks for critical paths",
      "steps": [
        "Add a small benchmark suite for hot paths (patch normalization, DB queries, progress dispatch)",
        "Run benchmarks in nightly CI with brownfield-friendly baselines and slack",
        "Fail only on significant regressions to avoid flakiness",
        "Keep the suite deterministic and resource-bounded"
      ],
      "passes": false
    },
    {
      "id": "ci-008-branch-protection-requirements",
      "priority": 60,
      "category": "ci",
      "description": "Define and verify branch protection expectations for main",
      "steps": [
        "Define required status checks (quality-gates, secret-scanning, codeql) and review requirements",
        "Optionally add a CI check that warns when branch protection is misconfigured (GitHub API)",
        "Ensure merge strategies align with the security posture (e.g., disallow force-push)",
        "Define an emergency override procedure with follow-up requirements"
      ],
      "passes": false
    },
    {
      "id": "foundation-005-devcontainer",
      "priority": 61,
      "category": "foundation",
      "description": "Provide an optional devcontainer for a reproducible development environment",
      "steps": [
        "Add a .devcontainer configuration that can run the full validator suite",
        "Ensure it uses the same pinned Python versions and locked dependencies as CI",
        "Keep it optional and avoid impacting non-container workflows",
        "Ensure it works on macOS/Linux hosts"
      ],
      "passes": false
    }
  ]
}
